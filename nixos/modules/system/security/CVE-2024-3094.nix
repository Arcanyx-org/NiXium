{ self, pkgs, system, ... }:

# Security management for CVE-2024-3094 (The XZ and LibArchive backdoor)

# NOTE-SECURITY(Krey): As of 31.03.2024 this is not known to affect NixOS, i am applying this in NiXium, because our infra has a paranoid setup

{
	system.replaceRuntimeDependencies = [
		# FIXME-QA(Krey): Only apply this unless the xz's version higher 5.3.1 or lower than 9.0.0
		{
			original = pkgs.xz;
			replacement = self.inputs.nixpkgs-staging-next.legacyPackages.${system}.xz;
		}
		{
			original = pkgs.libarchive;
			replacement = self.inputs.nixpkgs-staging-next.legacyPackages.${system}.libarchive;
		}
	];
}
